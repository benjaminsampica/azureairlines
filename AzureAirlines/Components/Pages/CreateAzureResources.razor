@page "/create-azure-resources"
@attribute [RenderModeInteractiveServer]

<h3>CreateAzureResources</h3>

<EditForm OnValidSubmit="ValidFormSubmitted" Model=@_model>

    <label>
        App Name
        <input type="text" class="form-control-lg" @bind-value="@_model.AppName" />
    </label>

    <button class="btn btn-lg btn-primary" disabled="@_model.IsCreateDisabled">Create</button>
</EditForm>

@code {

    readonly CreateAzureResourceModel _model = new();

    async Task ValidFormSubmitted(EditContext editContext)
    {
        _model.IsCreateDisabled = true;

        StateHasChanged();
        

        var template = new PulumiStackTemplate();
        var pulumiStack = template.TransformText();
        pulumiStack = pulumiStack.Replace("@AppName", _model.AppName);

var gitAction = new GitAction();
await gitAction.UploadFileAsync(pulumiStack, _model.AppName + ".cs");

        // TODO call github api
        //AutoCommit commit = new AutoCommit();
        //commit.Commit(_model.AppName, path);

    }

    class CreateAzureResourceModel
    {
        public string AppName { get; set; } = "devjam5";
        public bool IsCreateDisabled { get; set; }
    }
}